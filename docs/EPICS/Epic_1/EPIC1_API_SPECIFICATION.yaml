openapi: 3.0.0
info:
  title: Epic 1 Signal Quality Enhancement API
  version: 1.0.0
  description: |
    Epic 1 API provides enhanced trading signal analysis with dynamic StochRSI bands, 
    volume confirmation, and multi-timeframe validation for improved trading signal quality.
    
    ## Key Features
    - Dynamic StochRSI with adaptive volatility bands
    - Real-time volume confirmation analysis
    - Multi-timeframe signal validation
    - Comprehensive signal quality assessment
    - WebSocket support for real-time updates
    
    ## Authentication
    All Epic 1 endpoints require API key authentication via the `X-API-Key` header.
    
  contact:
    name: Epic 1 API Support
    email: support@trading-bot.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.trading-bot.com
    description: Production server
  - url: https://staging-api.trading-bot.com
    description: Staging server
  - url: http://localhost:5000
    description: Development server

paths:
  /api/epic1/status:
    get:
      summary: Get Epic 1 system status
      description: Returns the initialization status and availability of all Epic 1 components
      tags:
        - System Status
      responses:
        '200':
          description: Epic 1 system status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Epic1Status'
              example:
                status: "active"
                components:
                  dynamic_stochrsi:
                    enabled: true
                    initialized: true
                    last_update: "2025-08-19T10:30:00Z"
                  volume_confirmation:
                    enabled: true
                    initialized: true
                    last_update: "2025-08-19T10:30:00Z"
                  multi_timeframe:
                    enabled: true
                    initialized: true
                    timeframes: ["15m", "1h", "1d"]
                performance:
                  total_validations: 1523
                  approval_rate: 72.4
                  avg_processing_time: 45.2
        '500':
          $ref: '#/components/responses/ServerError'

  /api/epic1/enhanced-signal/{symbol}:
    get:
      summary: Get enhanced trading signal analysis
      description: |
        Provides comprehensive Epic 1 enhanced signal analysis including dynamic StochRSI,
        volume confirmation, and multi-timeframe validation for the specified symbol.
      tags:
        - Signal Analysis
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock symbol (e.g., AAPL, MSFT)
          schema:
            type: string
            pattern: '^[A-Z]{1,5}$'
            example: AAPL
        - name: timeframe
          in: query
          description: Timeframe for analysis
          schema:
            type: string
            enum: [1Min, 5Min, 15Min, 1Hour, 1Day]
            default: 1Min
        - name: limit
          in: query
          description: Number of data points to analyze
          schema:
            type: integer
            minimum: 50
            maximum: 1000
            default: 200
      responses:
        '200':
          description: Enhanced signal analysis result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnhancedSignal'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/epic1/volume-dashboard-data:
    get:
      summary: Get volume confirmation dashboard data
      description: Returns real-time volume analysis data for dashboard display
      tags:
        - Volume Analysis
      parameters:
        - name: symbol
          in: query
          description: Specific symbol to analyze (returns all if not specified)
          schema:
            type: string
            example: AAPL
        - name: timeframe
          in: query
          description: Timeframe for volume analysis
          schema:
            type: string
            enum: [1Min, 5Min, 15Min, 1Hour]
            default: 1Min
      responses:
        '200':
          description: Volume dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VolumeDashboardData'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/epic1/multi-timeframe/{symbol}:
    get:
      summary: Get multi-timeframe analysis
      description: Performs cross-timeframe trend analysis and consensus validation
      tags:
        - Multi-Timeframe
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock symbol for analysis
          schema:
            type: string
            example: AAPL
        - name: timeframes
          in: query
          description: Comma-separated list of timeframes to analyze
          schema:
            type: string
            default: "15m,1h,1d"
            example: "15m,1h,1d"
      responses:
        '200':
          description: Multi-timeframe analysis result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MultiTimeframeAnalysis'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/epic1/signal-quality/{symbol}:
    get:
      summary: Get signal quality assessment
      description: Provides comprehensive signal quality scoring and recommendations
      tags:
        - Signal Quality
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock symbol for quality assessment
          schema:
            type: string
            example: AAPL
        - name: timeframe
          in: query
          description: Timeframe for analysis
          schema:
            type: string
            enum: [1Min, 5Min, 15Min, 1Hour, 1Day]
            default: 1Min
        - name: include_history
          in: query
          description: Include historical quality performance data
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Signal quality assessment
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignalQuality'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/epic1/batch-validation:
    post:
      summary: Batch validate multiple signals
      description: Validates multiple trading signals simultaneously using Epic 1 features
      tags:
        - Signal Validation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchValidationRequest'
      responses:
        '200':
          description: Batch validation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchValidationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/ServerError'

components:
  schemas:
    Epic1Status:
      type: object
      properties:
        status:
          type: string
          enum: [active, initializing, error, disabled]
          description: Overall Epic 1 system status
        components:
          type: object
          properties:
            dynamic_stochrsi:
              $ref: '#/components/schemas/ComponentStatus'
            volume_confirmation:
              $ref: '#/components/schemas/ComponentStatus'
            multi_timeframe:
              allOf:
                - $ref: '#/components/schemas/ComponentStatus'
                - type: object
                  properties:
                    timeframes:
                      type: array
                      items:
                        type: string
                      example: ["15m", "1h", "1d"]
        performance:
          type: object
          properties:
            total_validations:
              type: integer
              description: Total number of validations performed
            approval_rate:
              type: number
              format: float
              description: Percentage of signals approved
            avg_processing_time:
              type: number
              format: float
              description: Average processing time in milliseconds

    ComponentStatus:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether the component is enabled
        initialized:
          type: boolean
          description: Whether the component is properly initialized
        last_update:
          type: string
          format: date-time
          description: Timestamp of last component update

    EnhancedSignal:
      type: object
      properties:
        symbol:
          type: string
          example: AAPL
        timestamp:
          type: string
          format: date-time
        signal_type:
          type: string
          enum: [buy, sell, hold]
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
        dynamic_stochrsi:
          $ref: '#/components/schemas/DynamicStochRSI'
        volume_confirmation:
          $ref: '#/components/schemas/VolumeConfirmation'
        multi_timeframe:
          $ref: '#/components/schemas/MultiTimeframeResult'
        signal_quality:
          $ref: '#/components/schemas/SignalQualityScore'

    DynamicStochRSI:
      type: object
      properties:
        value:
          type: number
          format: float
          description: Current StochRSI value
        k_value:
          type: number
          format: float
          description: Stochastic %K value
        d_value:
          type: number
          format: float
          description: Stochastic %D value
        dynamic_bands:
          type: object
          properties:
            lower:
              type: number
              format: float
              description: Dynamic lower band (oversold level)
            upper:
              type: number
              format: float
              description: Dynamic upper band (overbought level)
            volatility_ratio:
              type: number
              format: float
              description: Current volatility ratio
        signal:
          type: string
          enum: [oversold, overbought, neutral]

    VolumeConfirmation:
      type: object
      properties:
        confirmed:
          type: boolean
          description: Whether signal is volume confirmed
        volume_ratio:
          type: number
          format: float
          description: Current volume vs average volume ratio
        relative_volume:
          type: number
          format: float
          description: Relative volume strength
        volume_trend:
          type: string
          enum: [increasing, decreasing, stable]
        confidence_score:
          type: number
          format: float
          minimum: 0
          maximum: 1

    MultiTimeframeResult:
      type: object
      properties:
        consensus:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Consensus score across timeframes
        aligned:
          type: boolean
          description: Whether timeframes are aligned
        timeframes:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/TimeframeAnalysis'

    TimeframeAnalysis:
      type: object
      properties:
        direction:
          type: string
          enum: [bullish, bearish, neutral]
        strength:
          type: number
          format: float
          minimum: 0
          maximum: 1
        weight:
          type: number
          format: float
          description: Weight of this timeframe in consensus

    SignalQualityScore:
      type: object
      properties:
        score:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Overall quality score
        factors:
          type: object
          properties:
            volatility_appropriateness:
              type: number
              format: float
            volume_strength:
              type: number
              format: float
            trend_alignment:
              type: number
              format: float
            data_completeness:
              type: number
              format: float
        recommendation:
          type: string
          enum: [strong_buy, buy, hold, sell, strong_sell]

    VolumeDashboardData:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        data:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/VolumeData'
        summary:
          type: object
          properties:
            total_symbols:
              type: integer
            confirmed_signals:
              type: integer
            avg_volume_ratio:
              type: number
              format: float
            strong_volume_count:
              type: integer

    VolumeData:
      type: object
      properties:
        current_volume:
          type: integer
        volume_ma:
          type: number
          format: float
        volume_ratio:
          type: number
          format: float
        relative_volume:
          type: number
          format: float
        volume_trend:
          type: object
          properties:
            direction:
              type: string
              enum: [increasing, decreasing, stable]
            slope:
              type: number
              format: float
            r_squared:
              type: number
              format: float
        volume_profile:
          type: object
          properties:
            value_area_high:
              type: number
              format: float
            value_area_low:
              type: number
              format: float
            point_of_control:
              type: number
              format: float
        confirmation_status:
          type: string
          enum: [confirmed, rejected, pending]

    MultiTimeframeAnalysis:
      type: object
      properties:
        symbol:
          type: string
        timestamp:
          type: string
          format: date-time
        consensus:
          type: object
          properties:
            overall_score:
              type: number
              format: float
            aligned:
              type: boolean
            direction:
              type: string
              enum: [bullish, bearish, neutral]
            strength:
              type: string
              enum: [strong, moderate, weak]
        timeframes:
          type: object
          additionalProperties:
            type: object
            properties:
              trend:
                type: object
                properties:
                  direction:
                    type: string
                    enum: [bullish, bearish, neutral]
                  strength:
                    type: number
                    format: float
                  confidence:
                    type: number
                    format: float
              indicators:
                type: object
                properties:
                  stochrsi:
                    type: number
                    format: float
                  ema:
                    type: string
                    enum: [above, below, neutral]
                  volume:
                    type: string
                    enum: [strong, moderate, weak]
              weight:
                type: number
                format: float
              last_update:
                type: string
                format: date-time
        validation:
          type: object
          properties:
            passed:
              type: boolean
            score:
              type: number
              format: float
            threshold:
              type: number
              format: float
            factors:
              type: object
              properties:
                trend_alignment:
                  type: number
                  format: float
                momentum_consistency:
                  type: number
                  format: float
                volume_confirmation:
                  type: number
                  format: float

    SignalQuality:
      type: object
      properties:
        symbol:
          type: string
        timestamp:
          type: string
          format: date-time
        quality_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
        quality_grade:
          type: string
          enum: [A, B, C, D, F]
        factors:
          type: object
          additionalProperties:
            type: object
            properties:
              score:
                type: number
                format: float
              description:
                type: string
        recommendation:
          type: object
          properties:
            action:
              type: string
              enum: [strong_buy, buy, hold, sell, strong_sell]
            confidence:
              type: string
              enum: [high, medium, low]
            risk_level:
              type: string
              enum: [low, moderate, high]
            position_sizing:
              type: string
              enum: [aggressive, standard, conservative]
        warnings:
          type: array
          items:
            type: string
        historical_performance:
          type: object
          properties:
            similar_signals:
              type: integer
            success_rate:
              type: number
              format: float
            avg_return:
              type: number
              format: float

    BatchValidationRequest:
      type: object
      properties:
        signals:
          type: array
          items:
            type: object
            properties:
              symbol:
                type: string
              signal_type:
                type: string
                enum: [buy, sell]
              strength:
                type: number
                format: float
              timestamp:
                type: string
                format: date-time
          maxItems: 50
        validation_options:
          type: object
          properties:
            require_volume_confirmation:
              type: boolean
              default: true
            require_multi_timeframe:
              type: boolean
              default: true
            min_quality_score:
              type: number
              format: float
              default: 0.6

    BatchValidationResponse:
      type: object
      properties:
        results:
          type: array
          items:
            type: object
            properties:
              signal:
                type: object
              approved:
                type: boolean
              reason:
                type: string
              confidence:
                type: number
                format: float
              processing_time:
                type: number
                format: float
        summary:
          type: object
          properties:
            total:
              type: integer
            approved:
              type: integer
            rejected:
              type: integer
            errors:
              type: integer
        processing_time:
          type: number
          format: float

    Error:
      type: object
      properties:
        error:
          type: boolean
          default: true
        error_code:
          type: string
          example: EPIC1_001
        message:
          type: string
          example: Epic 1 component not initialized
        details:
          type: object
          properties:
            component:
              type: string
            reason:
              type: string
            suggestion:
              type: string
        timestamp:
          type: string
          format: date-time

  responses:
    BadRequest:
      description: Bad request - invalid parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: true
            error_code: EPIC1_002
            message: Invalid symbol format
            details:
              component: input_validation
              reason: Symbol must be 1-5 uppercase letters
              suggestion: Use valid stock symbol like AAPL
            timestamp: "2025-08-19T10:30:00Z"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: true
            error_code: EPIC1_404
            message: Symbol not found
            details:
              component: data_manager
              reason: No data available for symbol
              suggestion: Check symbol spelling or try again later
            timestamp: "2025-08-19T10:30:00Z"

    ServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: true
            error_code: EPIC1_500
            message: Internal server error
            details:
              component: system
              reason: Unexpected error occurred
              suggestion: Please try again or contact support
            timestamp: "2025-08-19T10:30:00Z"

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

security:
  - ApiKeyAuth: []

tags:
  - name: System Status
    description: Epic 1 system status and health checks
  - name: Signal Analysis
    description: Enhanced signal analysis with Epic 1 features
  - name: Volume Analysis
    description: Volume confirmation and analysis
  - name: Multi-Timeframe
    description: Cross-timeframe validation and consensus
  - name: Signal Quality
    description: Signal quality assessment and scoring
  - name: Signal Validation
    description: Batch signal validation operations

externalDocs:
  description: Epic 1 Complete Documentation
  url: /docs/EPIC1_COMPLETE_DOCUMENTATION.md