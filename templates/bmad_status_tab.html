<!-- BMAD Status Tab Content -->
<div class="container-fluid mt-3">
    <div class="row">
        <!-- Overall Status Card -->
        <div class="col-12 mb-4">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-check-circle me-2"></i>
                        BMAD Documentation Status: PRODUCTION READY
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h2 class="text-success">100%</h2>
                                <p class="text-muted">Overall Completeness</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h2 class="text-primary">24</h2>
                                <p class="text-muted">BMAD Files</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h2 class="text-info">8</h2>
                                <p class="text-muted">Templates</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h2 class="text-warning">30 min</h2>
                                <p class="text-muted">Setup Time</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BMAD Phases Status -->
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-tasks me-2"></i>
                        BMAD Phases Implementation
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row" id="bmad-phases-container">
                        <!-- Phases will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Documentation Categories -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-folder-open me-2"></i>
                        Documentation Categories
                    </h5>
                </div>
                <div class="card-body">
                    <div id="bmad-categories-container">
                        <!-- Categories will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Achievements & Features -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-trophy me-2"></i>
                        Achievements & Features
                    </h5>
                </div>
                <div class="card-body">
                    <div id="bmad-achievements-container">
                        <!-- Achievements will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Metrics Summary -->
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar me-2"></i>
                        BMAD Metrics Summary
                    </h5>
                </div>
                <div class="card-body">
                    <div id="bmad-metrics-container">
                        <!-- Metrics will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// BMAD Status Management
let bmadStatusData = null;

async function loadBMADStatus() {
    try {
        const response = await fetch('/api/bmad/status');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        bmadStatusData = data;
        renderBMADStatus(data);
    } catch (error) {
        console.error('Error loading BMAD status:', error);
        showBMADError(error.message);
    }
}

function renderBMADStatus(data) {
    // Render phases
    renderBMADPhases(data.phases || {});
    
    // Render categories
    renderBMADCategories(data.documentation?.categories || {});
    
    // Render achievements
    renderBMADAchievements(data.achievements || []);
    
    // Render metrics
    renderBMADMetrics(data.metrics || {});
}

function renderBMADPhases(phases) {
    const container = document.getElementById('bmad-phases-container');
    if (!container) return;
    
    const phasesHtml = Object.entries(phases).map(([key, phase]) => {
        const isComplete = phase.completeness === 100;
        const statusClass = isComplete ? 'success' : 'warning';
        const iconClass = isComplete ? 'check-circle' : 'clock';
        
        return `
            <div class="col-md-3 mb-3">
                <div class="card border-${statusClass}">
                    <div class="card-body text-center">
                        <i class="fas fa-${iconClass} text-${statusClass} mb-2" style="font-size: 2rem;"></i>
                        <h6 class="card-title">${phase.name || key.toUpperCase()}</h6>
                        <div class="progress mb-2" style="height: 10px;">
                            <div class="progress-bar bg-${statusClass}" 
                                 role="progressbar" 
                                 style="width: ${phase.completeness || 0}%"
                                 aria-valuenow="${phase.completeness || 0}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="100"></div>
                        </div>
                        <small class="text-muted">${phase.completeness || 0}% Complete</small>
                        <div class="mt-2">
                            <span class="badge bg-${statusClass}">${phase.status || 'UNKNOWN'}</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    
    container.innerHTML = phasesHtml || '<p class="text-muted">No phase data available</p>';
}

function renderBMADCategories(categories) {
    const container = document.getElementById('bmad-categories-container');
    if (!container) return;
    
    const categoriesHtml = Object.entries(categories).map(([key, category]) => {
        const percentage = category.percentage || 100;
        const isComplete = percentage === 100;
        const statusClass = isComplete ? 'success' : 'warning';
        
        return `
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="text-capitalize">${key.replace(/_/g, ' ')}</span>
                    <span class="badge bg-${statusClass}">${category.files || 0} files</span>
                </div>
                <div class="progress" style="height: 8px;">
                    <div class="progress-bar bg-${statusClass}" 
                         role="progressbar" 
                         style="width: ${percentage}%"
                         aria-valuenow="${percentage}" 
                         aria-valuemin="0" 
                         aria-valuemax="100"></div>
                </div>
            </div>
        `;
    }).join('');
    
    container.innerHTML = categoriesHtml || '<p class="text-muted">No category data available</p>';
}

function renderBMADAchievements(achievements) {
    const container = document.getElementById('bmad-achievements-container');
    if (!container) return;
    
    const achievementsHtml = achievements.map(achievement => `
        <div class="d-flex align-items-start mb-2">
            <i class="fas fa-check-circle text-success me-2 mt-1"></i>
            <span>${achievement}</span>
        </div>
    `).join('');
    
    container.innerHTML = achievementsHtml || '<p class="text-muted">No achievements data available</p>';
}

function renderBMADMetrics(metrics) {
    const container = document.getElementById('bmad-metrics-container');
    if (!container) return;
    
    const metricsHtml = `
        <div class="row">
            <div class="col-md-2 col-sm-4 text-center mb-3">
                <h4 class="text-primary">${metrics.documentation_files || 0}</h4>
                <small class="text-muted">Documentation Files</small>
            </div>
            <div class="col-md-2 col-sm-4 text-center mb-3">
                <h4 class="text-success">${metrics.templates_created || 0}</h4>
                <small class="text-muted">Templates</small>
            </div>
            <div class="col-md-2 col-sm-4 text-center mb-3">
                <h4 class="text-info">${metrics.guides_written || 0}</h4>
                <small class="text-muted">Guides</small>
            </div>
            <div class="col-md-2 col-sm-4 text-center mb-3">
                <h4 class="text-warning">${metrics.phases_documented || 0}</h4>
                <small class="text-muted">Phases</small>
            </div>
            <div class="col-md-2 col-sm-4 text-center mb-3">
                <h4 class="text-danger">${metrics.commands_documented || 0}</h4>
                <small class="text-muted">Commands</small>
            </div>
            <div class="col-md-2 col-sm-4 text-center mb-3">
                <h4 class="text-secondary">${metrics.kpis_defined || 0}</h4>
                <small class="text-muted">KPIs</small>
            </div>
        </div>
    `;
    
    container.innerHTML = metricsHtml;
}

function showBMADError(message) {
    const containers = [
        'bmad-phases-container',
        'bmad-categories-container',
        'bmad-achievements-container',
        'bmad-metrics-container'
    ];
    
    containers.forEach(id => {
        const container = document.getElementById(id);
        if (container) {
            container.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Error: ${message}
                </div>
            `;
        }
    });
}

// Load BMAD status when tab is shown
document.addEventListener('DOMContentLoaded', function() {
    // Check if we're on the BMAD tab
    const bmadTab = document.querySelector('[data-bs-target="#bmad-status"]');
    if (bmadTab) {
        bmadTab.addEventListener('shown.bs.tab', function() {
            loadBMADStatus();
        });
    }
    
    // Also load if already visible
    const bmadPane = document.getElementById('bmad-status');
    if (bmadPane && bmadPane.classList.contains('active')) {
        loadBMADStatus();
    }
});

// Refresh BMAD status function
function refreshBMADStatus() {
    loadBMADStatus();
}
</script>