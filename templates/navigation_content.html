{% extends "unified_master_dashboard.html" %}

{% block content %}
<!-- System Overview Alert -->
<div class="unified-alert alert-success">
    <i class="bi bi-check-circle"></i>
    <span>All systems operational - 3 core services running in unison</span>
</div>

<!-- Service Status Grid -->
<div class="unified-grid grid-3">
    <div class="unified-card">
        <div class="card-header">
            <div class="card-title">
                <i class="bi bi-speedometer2" style="color: var(--accent-green);"></i>
                Trading Dashboard
            </div>
            <span class="badge bg-success">Live</span>
        </div>
        <div class="card-content">
            <p class="mb-3">Real-time market data, positions, and automated trading with StochRSI and volume confirmation</p>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value metric-positive">$24,567</div>
                    <div class="metric-label">Portfolio Value</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value metric-neutral">3</div>
                    <div class="metric-label">Open Positions</div>
                </div>
            </div>
            <a href="/dashboard" class="btn-action btn-primary w-100 mt-3">
                <i class="bi bi-speedometer2"></i> View Dashboard
            </a>
        </div>
    </div>

    <div class="unified-card">
        <div class="card-header">
            <div class="card-title">
                <i class="bi bi-mortarboard" style="color: var(--accent-blue);"></i>
                AI Training Platform
            </div>
            <span class="badge bg-primary">Ready</span>
        </div>
        <div class="card-content">
            <p class="mb-3">Collaborative human-AI trading strategy development with real-time analysis and learning scenarios</p>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value metric-positive">4</div>
                    <div class="metric-label">Strategies</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value metric-neutral">3</div>
                    <div class="metric-label">Scenarios</div>
                </div>
            </div>
            <a href="/training" class="btn-action btn-primary w-100 mt-3">
                <i class="bi bi-mortarboard"></i> Start Training
            </a>
        </div>
    </div>

    <div class="unified-card">
        <div class="card-header">
            <div class="card-title">
                <i class="bi bi-briefcase" style="color: var(--accent-orange);"></i>
                Portfolio Management
            </div>
            <span class="badge bg-warning">Active</span>
        </div>
        <div class="card-content">
            <p class="mb-3">Track positions, P&L, and portfolio performance across all your holdings</p>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value metric-positive">73.2%</div>
                    <div class="metric-label">Win Rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value metric-positive">+2.34%</div>
                    <div class="metric-label">Today</div>
                </div>
            </div>
            <a href="/portfolio" class="btn-action btn-primary w-100 mt-3">
                <i class="bi bi-briefcase"></i> View Portfolio
            </a>
        </div>
    </div>
</div>

<!-- Available Features Grid -->
<div class="unified-card">
    <div class="card-header">
        <div class="card-title">
            <i class="bi bi-grid-3x3"></i>
            Available Features
        </div>
    </div>
    <div class="unified-grid grid-4">
        <div class="feature-card" onclick="window.location.href='/trading'">
            <i class="bi bi-graph-up feature-icon"></i>
            <h5>Trading Execution</h5>
            <p>Execute trades and monitor market conditions</p>
        </div>
        <div class="feature-card" onclick="window.location.href='/analytics'">
            <i class="bi bi-bar-chart feature-icon"></i>
            <h5>Analytics & Reports</h5>
            <p>Performance metrics and strategy analysis</p>
        </div>
        <div class="feature-card" onclick="window.location.href='/backtesting'">
            <i class="bi bi-clock-history feature-icon"></i>
            <h5>Strategy Backtesting</h5>
            <p>Test strategies against historical data</p>
        </div>
        <div class="feature-card" onclick="window.location.href='/config'">
            <i class="bi bi-gear feature-icon"></i>
            <h5>System Configuration</h5>
            <p>Manage settings and parameters</p>
        </div>
        <div class="feature-card" onclick="window.location.href='/monitoring'">
            <i class="bi bi-activity feature-icon"></i>
            <h5>System Monitoring</h5>
            <p>Monitor health and performance</p>
        </div>
        <div class="feature-card" onclick="window.location.href='/afterhours'">
            <i class="bi bi-moon-stars feature-icon"></i>
            <h5>After-Hours Trading</h5>
            <p>Extended hours markets and overnight positions</p>
        </div>
        <div class="feature-card" onclick="window.location.href='/futures'">
            <i class="bi bi-graph-up-arrow feature-icon"></i>
            <h5>Futures & Risk</h5>
            <p>Advanced futures tracking and risk management</p>
        </div>
        <div class="feature-card" onclick="checkAllServices()">
            <i class="bi bi-heart-pulse feature-icon"></i>
            <h5>Health Check</h5>
            <p>Verify all services status</p>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="unified-grid grid-2">
    <div class="unified-card">
        <div class="card-header">
            <div class="card-title">
                <i class="bi bi-lightning"></i>
                Quick Actions
            </div>
        </div>
        <div class="d-grid gap-2">
            <a href="/training" class="btn-action btn-primary">
                <i class="bi bi-mortarboard"></i> Start AI Training Session
            </a>
            <a href="/dashboard" class="btn-action btn-secondary">
                <i class="bi bi-speedometer2"></i> View Live Dashboard
            </a>
            <a href="/portfolio" class="btn-action btn-secondary">
                <i class="bi bi-briefcase"></i> Check Portfolio
            </a>
        </div>
    </div>

    <div class="unified-card">
        <div class="card-header">
            <div class="card-title">
                <i class="bi bi-info-circle"></i>
                System Information
            </div>
        </div>
        <div class="info-grid">
            <div class="info-row">
                <span>Frontend Service</span>
                <span class="badge bg-success">Port 9100</span>
            </div>
            <div class="info-row">
                <span>API Gateway</span>
                <span class="badge bg-success">Port 9000</span>
            </div>
            <div class="info-row">
                <span>Training Service</span>
                <span class="badge bg-primary">Port 9011</span>
            </div>
            <div class="info-row">
                <span>Architecture</span>
                <span class="badge bg-secondary">Microservices</span>
            </div>
            <div class="info-row">
                <span>Framework</span>
                <span class="badge bg-info">FastAPI + React</span>
            </div>
        </div>
    </div>
</div>

<style>
.feature-card {
    background: var(--tertiary-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}

.feature-card:hover {
    border-color: var(--accent-green);
    transform: translateY(-2px);
    box-shadow: var(--card-shadow);
}

.feature-icon {
    font-size: 32px;
    color: var(--accent-green);
    margin-bottom: 10px;
    display: block;
}

.feature-card h5 {
    margin-bottom: 10px;
    color: var(--text-primary);
}

.feature-card p {
    color: var(--text-secondary);
    font-size: 14px;
    margin: 0;
}

.info-grid {
    display: grid;
    gap: 10px;
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
}
</style>
{% endblock %}

{% block scripts %}
<script>
function initializePage() {
    loadServiceStatus();
    setInterval(loadServiceStatus, 30000);
}

async function loadServiceStatus() {
    try {
        // Check services and update badges
        const services = [
            { name: 'frontend', url: '/health' },
            { name: 'training', url: 'http://localhost:9011/health' },
            { name: 'gateway', url: 'http://localhost:9000/health' }
        ];
        
        for (const service of services) {
            try {
                const response = await fetch(service.url);
                const status = response.ok ? 'online' : 'offline';
                updateServiceBadge(service.name, status);
            } catch (e) {
                updateServiceBadge(service.name, 'offline');
            }
        }
    } catch (error) {
        console.error('Service status check failed:', error);
    }
}

function updateServiceBadge(serviceName, status) {
    // Update service status in the UI
    console.log(`Service ${serviceName}: ${status}`);
}

async function checkAllServices() {
    showAlert('Checking all services...', 'info');
    
    const services = [
        'Frontend Service (9100)',
        'Training Service (9011)', 
        'API Gateway (9000)'
    ];
    
    let onlineCount = 0;
    
    for (const service of services) {
        // Simulate service check
        await new Promise(resolve => setTimeout(resolve, 500));
        onlineCount++;
    }
    
    showAlert(`✅ ${onlineCount}/${services.length} services online and operational`, 'success');
}

// Export for global access
window.checkAllServices = checkAllServices;
</script>
{% endblock %}