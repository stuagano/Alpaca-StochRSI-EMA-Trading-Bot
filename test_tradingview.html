<!DOCTYPE html>
<html>
<head>
    <title>TradingView Quick Test</title>
    <style>
        body { background: #1a1a2e; color: white; font-family: Arial; padding: 20px; }
        .status { padding: 10px; background: #0f3460; border-radius: 5px; margin: 10px 0; }
        .success { background: #1b5e20; }
        .error { background: #b71c1c; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>TradingView Integration Test</h1>
    
    <div class="status" id="status">Click a button to test the API</div>
    
    <button onclick="testSuperTrend('SPY')">Test SuperTrend SPY</button>
    <button onclick="testSuperTrend('AMD')">Test SuperTrend AMD</button>
    <button onclick="testAccount()">Test Account</button>
    <button onclick="testPositions()">Test Positions</button>
    
    <h2>Results:</h2>
    <pre id="results"></pre>
    
    <h2>Live Dashboard:</h2>
    <p><a href="http://localhost:9765" target="_blank" style="color: #4CAF50;">Open TradingView Dashboard →</a></p>
    
    <script>
        const API_BASE = 'http://localhost:9765';
        
        async function testSuperTrend(symbol) {
            try {
                document.getElementById('status').textContent = `Testing SuperTrend for ${symbol}...`;
                const response = await fetch(`${API_BASE}/api/supertrend/${symbol}`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('status').className = 'status success';
                    document.getElementById('status').textContent = `✅ SuperTrend API Working!`;
                    
                    const summary = `
SuperTrend Signal for ${symbol}:
- Signal: ${data.signal} (${data.signal === 1 ? 'BUY' : data.signal === -1 ? 'SELL' : 'NEUTRAL'})
- Trend: ${data.trend}
- Action: ${data.action}
- Current Price: $${data.current_price}
- SuperTrend Value: $${data.supertrend_value}

Multi-Timeframe Analysis:
- Overall Signal: ${data.multi_timeframe.overall_signal}
- Overall Trend: ${data.multi_timeframe.overall_trend}
- Confidence: ${(data.multi_timeframe.confidence * 100).toFixed(1)}%
- Signal Alignment: ${data.multi_timeframe.signal_alignment ? 'YES' : 'NO'}
                    `;
                    document.getElementById('results').textContent = summary;
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = `❌ Error: ${error.message}`;
                document.getElementById('results').textContent = error.toString();
            }
        }
        
        async function testAccount() {
            try {
                document.getElementById('status').textContent = 'Testing Account API...';
                const response = await fetch(`${API_BASE}/api/account`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('status').className = 'status success';
                    document.getElementById('status').textContent = '✅ Account API Working!';
                    document.getElementById('results').textContent = JSON.stringify(data.account, null, 2);
                } else {
                    throw new Error(data.error || 'Failed to fetch account');
                }
            } catch (error) {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = `❌ Error: ${error.message}`;
                document.getElementById('results').textContent = error.toString();
            }
        }
        
        async function testPositions() {
            try {
                document.getElementById('status').textContent = 'Testing Positions API...';
                const response = await fetch(`${API_BASE}/api/positions`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('status').className = 'status success';
                    document.getElementById('status').textContent = '✅ Positions API Working!';
                    document.getElementById('results').textContent = JSON.stringify(data.positions, null, 2);
                } else {
                    throw new Error(data.error || 'Failed to fetch positions');
                }
            } catch (error) {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = `❌ Error: ${error.message}`;
                document.getElementById('results').textContent = error.toString();
            }
        }
    </script>
</body>
</html>